<!DOCTYPE html>
<html ng-app="app">
<head>
<!-- Title -->
    	<title>RFP Counter Demo</title>
<!-- meta data -->
	<meta charset="utf-8">
    	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    	<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- AngularJS -->
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
<!-- Firebase -->
	<script src="https://cdn.firebase.com/js/client/2.2.4/firebase.js"></script>
<!-- AngularFire -->
	<script src="https://cdn.firebase.com/libs/angularfire/1.1.2/angularfire.min.js"></script>
<!-- BootStrap -->
	<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<!-- jQuery library -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<!-- Latest compiled JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	
<!-- Angular app -->
	<script>
	var app = angular.module("app", ["firebase"]);
	app.controller("RootCtrl", function($scope, $firebaseArray) {
            
        // Database URL
        var dbURL = "https://rfpcounter.firebaseio.com/"
        // Set database path references for RFPs
        var refRfp = new Firebase(dbURL + 'RFPs/');
	// Bind (three-way)
        $scope.rfps = $firebaseArray(refRfp);
			
        // Set database path references for Totals
        var refTotal = new Firebase(dbURL + 'Totals/');
        // Bind (three-way)
        $scope.totals = $firebaseArray(refTotal);
		
	// Variables
	$scope.newRFP = {}
        $scope.newTotal = {}
	$scope.lockName = false;
        
            
            // Update Function
            const totalsPath = new Firebase(dbURL + 'Totals/Array/');
		
            $scope.updateAllTotals = function(){
            
		// Set Total
		totalsPath.update({
		tenTillEleven: $scope.newTotal.tenTillEleven;
		});
		matchTotalAndRfp();
            }
	    
	    /*
	    const rfpsPath = new Firebase(dbURL + 'RFPs/Array/');
	    function matchTotalAndRfp(){
	    
		// Set RFP to Total Value
		rfpsPath.update({
		tenTillEleven: $scope.newTotal.tenTillEleven;
		});
	    }
            */
            
            // Dcrease Number 
            var decreaseRfp = new Firebase(dbURL + 'RFPs/Array/');
            var rfpData = $firebaseArray(new Firebase(dbURL + 'RFPs/Array/'));
            var myNum = {}
            $scope.decreaseTotal = function(num){
                
                $scope.decreaseRfp = rfpData;
                
                if (num == 10-11){
                    var tenTillElevenRec = rfpData.$getRecord("tenTillEleven");
                    var tenTillElevenNum = tenTillElevenRec.$value
                    if (tenTillElevenNum > 0) {
                        decreaseRfp.update({
                        tenTillEleven: tenTillElevenNum - 1
                        });
                        DemoCtrl(tenTillElevenNum);
                    }
                }
                if (num == 2){
                    var elevenTillTwelveNum = tenTillElevenRec.$value
                    if (elevenTillTwelveNum > 0) {
                        decreaseRfp.update({
                        tenTillEleven: elevenTillTwelveNum - 1
                        });
                    }
                }
            }
         
            
            
            function DemoCtrl(num) {
              // you can change this as you like. its just for demo purposes.
              $scope.hgt = num;
            }
            
            // Load Bars on page load
            angular.element(document).ready(function () {
            
            $scope.hgt = 100;

            });
            
        
            
            
    });
	</script>
    
    <!-- Additional JavaScript -->
    <script>
        document.getElementById("myNavbar")
        .addEventListener("keyup", function(event) {
        event.preventDefault();
        if (event.keyCode === 13) {
        document.getElementById("#Set").click();
        }
        
            
    });
    </script>
    
    <style>
        .smallText {
            font-size: 14px;
        }
        
        input[type="text"] {
    box-sizing: border-box;
}
    
    </style>
</head>
<body ng-controller="RootCtrl">

<!-- Navbar -->
<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span> 
      </button>
      <a class="navbar-brand" href="#">ï£¿</a>
    </div>
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="#" id="Set" button data-toggle="collapse" data-target="#demo, #demo1"><span class="glyphicon glyphicon-user"></span></button> Set Totals</a></li>
      </ul>
    </div>
  </div>
</nav>
	
	<div class="jumbotron text-center">
		<h1>Hi Matt?</h1>
	</div>
	
	<div class="container text-center">
        
        <div id="demo" class="collapse">
<h1>Set Totals</h1>
<p>Click button to set totals</p>
<button ng-disabled="!newTotal.tenTillEleven" ng-click="updateAllTotals()" class="btn btn-primary btn-sm">Set</button>            
</div>
		
  		<div class="row" ng-repeat="rfp in rfps">
			<div class="col-xs-3" ng-repeat="total in totals">
				<h5>10am - 11am</h5>
                <h2>{{rfp.tenTillEleven}} / <span class="smallText">{{total.tenTillEleven}}</span></h2>
                <button ng-click="decreaseTotal(10-11)" type="button" class="btn btn-primary btn-sm">Use</button>
                
                <div id="demo1" class="collapse">
                    <h5>Total</h5><input ng-model="newTotal.tenTillEleven" class="form-control input-sm" placeholder="Total"/>
                </div>
			</div>
            <div class="col-xs-3">
				<h5>11am - 12pm</h5>
                <h2>{{rfp.elevenTillTwelve}}</h2>
                <button ng-click="decreaseTotal(11-12)" type="button" class="btn btn-primary btn-sm">Use</button>
			</div>
            <div class="col-xs-3">
				<h5>12pm - 1pm</h5>
                <h2>{{rfp.twelveTillOne}}</h2>
                <button ng-click="decreaseTotal(12-1)" type="button" class="btn btn-primary btn-sm">Use</button>
			</div>
            <div class="col-xs-3">
				<h5>1pm - 2pm</h5>    
                <h2>{{rfp.OneTillTwo}}</h2>
                <button ng-click="decreaseTotal(1-2)" type="button" class="btn btn-primary btn-sm">Use</button>
			</div>
		</div>
        
		<div class="row">
			<div class="col-sm-4"></div>
			<div class="col-sm-4">
				<button ng-disabled="!newRFP.tenTillEleven" ng-click="updateRFP()">Set</button>
				<button ng-click="update()">Update</button>
			</div>
			<div class="col-sm-4"></div>
		</div>
		
		<div class="row" ng-repeat="rfp in rfps">
			<div class="col-sm-12" ng-repeat="total in totals">
				<h1>{{rfp.tenTillEleven}} / {{total.tenTillEleven}}</h1>
			</div>
		</div>
        
        <div style="background-color: lightblue; height: {{ hgt }}px">
            
        </div>
        
		
    <!-- Last Div -->
	</div>
	
</body>
</html>
